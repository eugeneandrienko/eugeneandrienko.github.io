---
layout: post
title: Plain text accounting
category: it
date: 2023-12-20
lang: ru
comments: true
hidden:
  - related_posts
summary: Ведение личного бюджета методом «денежных конвертов» при помощи hledger, sed, awk и sqlite.
---

<p>
С давних пор, как только устроился на свою первую работу, я вёл бюджет — чтобы
понимать сколько и на что я трачу, сколько по каким статьям бюджета я могу
потратить и так далее. К тому же, просто приятно глядеть на числа со своими
доходами (и, увы, менее приятно — на свои расходы).
</p>
<div class="outline-2">
<h2>Блокнот и ручка</h2>
<div class="outline-text-2">
<p>
Изначально средством для ведения бюджета была просто перьевая ручка и блокнот,
куда я записывал планируемые расходы на пару недель (от зарплаты до аванса и
наоборот) и планируемый остаток. Статьи бюджета определились сами собой, над
ними я долго не думал:
</p>
<ul class="org-ul">
<li><b>связь</b>: интернет и мобильный телефон</li>
<li><b>еда</b></li>
<li><b>досуг</b>: тут всё, от чего я отдыхаю — от кино и ресторанов, до покупки
термопасты</li>
<li><b>быт</b>: всякая бытовая химия</li>
<li><b>аренда</b>: аренда квартиры</li>
<li><b>здоровье</b>: аптеки, походы по врачам и прочие развлечения для тех, кому за
30</li>
<li><b>транспорт</b>: автобусы, метро и такси</li>
<li>и так далее.</li>
</ul>

<pre class="example">
|----------------+------------------+-------------------|
| Budget item    | Planned expenses | Planned remainder |
|----------------+------------------+-------------------|
| Communications |              500 |             13000 |
| Food           |            10000 |              3000 |
| Household      |             2000 |              1000 |
| Transport      |             1000 |                 0 |
|----------------+------------------+-------------------|
</pre>

<p>
Как нетрудно заметить, я использую методику «конвертов» для планирования
расходов. Только конверты у меня виртуальные — статьи бюджета в таблице.
</p>

<p>
Достаточно быстро я понял, что мне нужно ещё записывать и числа с реальными
расходами в эту таблицу. В жизни достаточно редко получается так, что на то же
<i>здоровье</i> или на <i>еду</i> ты тратишь столько же, сколько и запланировал — а потом
сидишь и недоумеваешь по какому «конверту» ты ушёл в минус.
</p>


<div class="figure">
<p><img src="/assets/static/paper_budget.jpg" alt="paper_budget.jpg" />
</p>
</div>

<p>
Эти расходы я высчитывал вручную в конце каждых двух недель — просто садился с
калькулятором и открытым списком трат в интернет-банке.
</p>
</div>
</div>
<div class="outline-2">
<h2>Emacs и Org Mode</h2>
<div class="outline-text-2">
<p>
Через пару лет мне надоело считать расходы на калькуляторе. К тому же,
хотелось видеть ещё и реальный остаток по статьям бюджета, обновляемый в
реальном времени, а не через каждые две недели. И общий остаток средств на
счёте, рассчитанный исключительно по данным из таблицы — чтобы контролировать
таким образом правильность введённых расходов.
</p>

<p>
Для этого уже нужен был какой-нибудь табличный процессор, а не блокнот с
ручкой. Поскольку я люблю сидеть в консоли и пользуюсь Emacs — я обратил своё
внимание в сторону <a href="https://orgmode.org/">Org Mode</a>. В нём как раз можно делать таблицы и работать с
ячейками при помощи формул — как обычных табличных, так и на Emacs Lisp'е.
</p>

<p>
Почитав документацию я набросал такие таблицы для своего двухнедельного
бюджета:
</p>
<div class="org-src-container">
<pre class="src src-org"><span style="color: #93a1a1; font-style: italic;">#+NAME: incoming</span>
<span style="color: #859900;">|---+----------------+--------|</span>
<span style="color: #859900;">|   | Incoming       | Amount |</span>
<span style="color: #859900;">|---+----------------+--------|</span>
<span style="color: #859900;">| </span><span style="color: #b58900;">#</span><span style="color: #859900;"> | Salary         |   7000 |</span>
<span style="color: #859900;">| </span><span style="color: #b58900;">#</span><span style="color: #859900;"> | Past food      |    900 |</span>
<span style="color: #859900;">| </span><span style="color: #b58900;">#</span><span style="color: #859900;"> | Past household |    289 |</span>
<span style="color: #859900;">| </span><span style="color: #b58900;">#</span><span style="color: #859900;"> | Past transport |    170 |</span>
<span style="color: #859900;">| </span><span style="color: #b58900;">#</span><span style="color: #859900;"> | Past health    |    322 |</span>
<span style="color: #859900;">|   | All:           |   8681 |</span>
<span style="color: #859900;">|</span><span style="color: #b58900;"> ^ |                |    all </span><span style="color: #859900;">|</span>
<span style="color: #859900;">|---+----------------+--------|</span>
<span style="color: #93a1a1; font-style: italic;">#+TBLFM: $all=vsum(@2$3..@&gt;&gt;&gt;$3)</span>

<span style="color: #93a1a1; font-style: italic;">#+NAME: budget</span>
<span style="color: #859900;">|---+---------------+----------+-----------+---------------+----------------|</span>
<span style="color: #859900;">|   | Expenditure   | Spending | Remainder | Real spending | Real remainder |</span>
<span style="color: #859900;">|---+---------------+----------+-----------+---------------+----------------|</span>
<span style="color: #859900;">| </span><span style="color: #b58900;">#</span><span style="color: #859900;"> | HCS           |     1000 |      7681 |               |           1000 |</span>
<span style="color: #859900;">| </span><span style="color: #b58900;">#</span><span style="color: #859900;"> | Rent          |     2000 |      5681 |               |           2000 |</span>
<span style="color: #859900;">| </span><span style="color: #b58900;">#</span><span style="color: #859900;"> | Communication |      600 |      5081 |               |            600 |</span>
<span style="color: #859900;">| </span><span style="color: #b58900;">#</span><span style="color: #859900;"> | Food          |     2590 |      2491 |           374 |           2216 |</span>
<span style="color: #859900;">| </span><span style="color: #b58900;">#</span><span style="color: #859900;"> | Household     |      400 |      2091 |           100 |            300 |</span>
<span style="color: #859900;">| </span><span style="color: #b58900;">#</span><span style="color: #859900;"> | Leisure       |     1000 |      1091 |           449 |            551 |</span>
<span style="color: #859900;">| </span><span style="color: #b58900;">#</span><span style="color: #859900;"> | Transport     |      500 |       591 |            80 |            420 |</span>
<span style="color: #859900;">| </span><span style="color: #b58900;">#</span><span style="color: #859900;"> | Health        |      591 |         0 |           100 |            491 |</span>
<span style="color: #859900;">|---+---------------+----------+-----------+---------------+----------------|</span>
<span style="color: #859900;">|   |               |          |         0 |      Overall: |           7578 |</span>
<span style="color: #859900;">|</span><span style="color: #b58900;"> ^ |               |          |         0 |               |        overall </span><span style="color: #859900;">|</span>
<span style="color: #859900;">|---+---------------+----------+-----------+---------------+----------------|</span>
<span style="color: #93a1a1; font-style: italic;">#+TBLFM: $6=$3-$5::@2$4=remote(incoming, $all)-@2$3::@3$4..@&gt;$4=@-1$4-@0$3::$overall=vsum(@II..III$6)</span>
</pre>
</div>

<p>
Ну и плюс ещё пара таблиц, заполняемых вручную — одна с данными по
накоплениям, а вторая со статистикой расходов по месяцам.
</p>

<p>
Работало всё это следующим образом. В таблицу с именем <code>incoming</code> вводились
данные по доходам и их сумма автоматически попадала в ячейку <code>all</code>. На основании
суммы всех доходов рассчитывался планируемый остаток по бюджетным статьям, а
также реальный остаток средств на счёте в ячейке <code>overall</code> из таблицы <code>budget</code>.
</p>

<p>
Какое-то время такая автоматизация меня устраивала. Просто вечером смотришь
расходы в уведомлениях от банка, складываешь числа для нужной категории и
обновляешь соответствующую ячейку с расходами в таблице.
</p>

<p>
Но тут были и свои неудобства, которые всё так же хотелось бы
автоматизировать. Во-первых, иногда я забывал указать или неправильно
суммировал расходы, из-за чего числа в соответствующей строке таблицы
расходились с реальностью. Из-за того, что данных по каждой транзакции тут не
сохранялось, править такие ошибки было сложно и приходилось «угадывать», что и
где я забыл.
</p>

<p>
Во-вторых, вести статистику расходов по месяцам было сложно — каждые две
недели надо было вручную складывать суммы и обновлять данные в таблице со
статистикой. Аналогично и для накоплений. К тому же, не было никакого
вменяемого доступа к таблицам за прошлые месяцы — в Org Mode не было
machine-friendly интерфейса для работы с архивированными таблицами. Разве что
написать много-много сложных регулярок, которые будут разбирать даты и данные.
</p>
</div>
</div>
<div class="outline-2">
<h2>Hledger и SQL-скрипты</h2>
<div class="outline-text-2">
<p>
В этот момент я и задумался о каком-нибудь более простом способе ведения
бюджета. Я уже что-то слышал о <a href="https://plaintextaccounting.org/">plain-text accounting'е</a>, да и к тому же мне
попалась на глаза статья про <a href="https://vas3k.club/post/15073/">Plain text бухгалтерию</a> в Вастрик.Клубе. С первого
раза с ledger'ом не заладилось — руководства и how-to были переусложнены
примерами с кредитными счетами, счетами с акциями, долгами и т.д. и т.п., чего
у меня никогда не водилось. К тому же всё руководства исходили из того, что вы
ведёте свой бюджет непрерывно — постоянно записываете все расходы, без
двухнедельных периодов, как у меня, из-за чего было не так-то просто перевести
мои табличные структуры в сквозной список трат. И ещё было совершенно
неочевидно, как адаптировать систему «денежных конвертов» для ledger'а.
</p>

<p>
К счастью, потом я наткнулся на <a href="https://hledger.org/">hledger</a> и смог разобраться с принципами, по
которым он работает. Всё оказалось достаточно просто. Как я понял, hledger не
является «серебряной пулей», которая будет всё автоматически считать за
вас. На самом деле это просто что-то вроде куцей базы данных, которая
позволяет SELECT'ить данные по финансовым транзакциям, фильтруя их по имени
счёта или по дате и т.д., с приятной возможностью конвертировать на лету одни
валюты в другие.
</p>

<p>
Всё остальное накручивается уже поверх этой функциональности.
</p>


<div class="figure">
<p><img src="/assets/static/main_ledger_window.png" alt="main_ledger_window.png" />
</p>
</div>
</div>
<div class="outline-3">
<h3>«Денежные конверты» в hledger</h3>
<div class="outline-text-3">
<p>
Чтобы методика «денежных конвертов» заработала в hledger, мне пришлось
попотеть. К счастью, и до меня были люди, который пользовались ей и plain-text
accounting. Основную идею я взял <a href="https://github.com/simonmichael/hledger/blob/master/examples/budgeting/envelope-budget-auto-1.journal">отсюда</a>.
</p>

<p>
Сначала мне пришлось описать все свои расходные счета:
</p>
<div class="org-src-container">
<pre class="src src-ledger">account expenses                ; type: X
account expenses:hcs            ; type: X
account expenses:rent           ; type: X
account expenses:communication  ; type: X
account expenses:food           ; type: X
account expenses:household      ; type: X
account expenses:leisure        ; type: X
account expenses:transport      ; type: X
account expenses:psychotherapy  ; type: X
account expenses:health         ; type: X
</pre>
</div>

<p>
И основной счёт, с которого списываются деньги: <code>main account:rub</code>. На этом
этапе всё работало по мануалу — пишем сколько денег ушло на счёт с расходами,
сколько денег ушло с основного счёта. Попытка добавить отдельные счёта для
статей бюджета — ломала мне всю систему, <code>hledger balance</code> отображал какие-то
оторванные от реальности числа в отчёте.
</p>

<p>
К счастью, <a href="https://hledger.org/1.32/hledger.html#virtual-postings">виртуальные счета</a> спасли меня. Они, плюс правила, связывающие
расходные и виртуальные счета — помогли избежать как странных чисел в отчёте
hledger, так и необходимости указывать бюджетные счета для каждой транзакции.
</p>
<div class="org-src-container">
<pre class="src src-ledger">account budget:hcs            ; type: X
account budget:rent           ; type: X
account budget:communication  ; type: X
account budget:food           ; type: X
account budget:household      ; type: X
account budget:leisure        ; type: X
account budget:transport      ; type: X
account budget:psychotherapy  ; type: X
account budget:health         ; type: X

= ^expenses:hcs
    (budget:hcs)                *-1
= ^expenses:rent
    (budget:rent)               *-1
= ^expenses:communication
    (budget:communication)      *-1
= ^expenses:food
    (budget:food)               *-1
= ^expenses:household
    (budget:household)          *-1
= ^expenses:leisure
    (budget:leisure)            *-1
= ^expenses:transport
    (budget:transport)          *-1
= ^expenses:psychotherapy
    (budget:psychotherapy)      *-1
= ^expenses:health
    (budget:health)             *-1
</pre>
</div>

<p>
Дальнейшие трудности были связаны с тем, что каждые две недели у меня новый
бюджет и, соответственно новые конверты. А ещё куча архивных данных из Org
Mode, где 100% сходимости бюджета нет — переводы денег в накопления не
отражались нигде, а высчитывать их было сложно и муторно. Да даже если и
высчитать, то в отчёте hledger'а опять таки отображались какие-то невероятные
числа, не связанные с моими расходами за каждые пару недель.
</p>

<p>
От невероятных чисел я избавился при помощи ключей <code>-b YYYY-MM-DD</code> и <code>-e
YYYY-MM-DD</code>, с которыми hledger смотрел только на данные за пару недель
бюджетной итерации. Чтобы он не сходил с ума по поводу доходов, накоплений и
расходов — в начале каждого бюджетного периода я, специальным скриптом,
добавляю в файл явно указанные суммы накоплений и планируемые расходы на этот
период:
</p>
<div class="org-src-container">
<pre class="src src-ledger">2023-12-14 "" | Balancing
    savings:touching     340.08 RUB
    savings:emergency    793.29 RUB
    savings:investments  0 RUB
    savings:foreign     $1
    savings:foreign      1 EUR
    equity:fix

2023-12-14 "" | Salary
    income:paycheck:job       -6000 RUB
    income:from past          -1489 RUB
    main account:rub

2023-12-14 "" | Budgeting
    (budget:hcs)            500 RUB
    (budget:rent)           2000 RUB
    (budget:food)           2500 RUB
    (budget:communication)  600 RUB
    (budget:household)      1000 RUB
    (budget:leisure)        1000 RUB
    (budget:transport)      500 RUB
    (budget:psychotherapy)  1000 RUB
    (budget:health)         1000 RUB
</pre>
</div>

<p>
Из-за того, что мы ограничили scope hledger'а парой недель — нужно указывать
суммы по всем накопительным счетам, даже если там ноль. Иначе hledger не будет
выводить пустые счета в своём отчёте.
</p>

<p>
Кроме того, чтобы в отчёте были данные по всем бюджетным и расходным счетам,
даже если мы ничего не потратили за пару недель — приходится сразу добавлять
транзакции с нулём рублей:
</p>
<div class="org-src-container">
<pre class="src src-ledger">2023-12-14 HCS
    expenses:hcs        0 RUB
    main account:rub    0 RUB

2023-12-14 Rent
    expenses:rent       0 RUB
    main account:rub    0 RUB

2023-12-14 Communication
    expenses:communication    0 RUB
    main account:rub          0 RUB

2023-12-14 Food
    expenses:food       0 RUB
    main account:rub    0 RUB

2023-12-14 Household
    expenses:household    0 RUB
    main account:rub      0 RUB

2023-12-14 Leisure
    expenses:leisure      0 RUB
    main account:rub      0 RUB

2023-12-14 Transport
    expenses:transport    0 RUB
    main account:rub      0 RUB

2023-12-14 Psychotherapy
    expenses:psychotherapy    0 RUB
    main account:rub          0 RUB

2023-12-14 Health
    expenses:health     0 RUB
    main account:rub    0 RUB
</pre>
</div>
</div>
</div>
<div class="outline-3">
<h3>Конвертация в рубли</h3>
<div class="outline-text-3">
<p>
Дальнейшую обработку всех этих финансовых данных сильно усложняет то, что
некоторые из счетов мультивалютные. К счастью, hledger тут может помочь — он
сам переводит суммы из долларов и евро в рубли. Для этого надо в команде
указать параметр <code>--value=then,RUB</code>, например:
</p>
<div class="org-src-container">
<pre class="src src-bash">hledger -s --value=then,RUB reg -M -E -O csv <span style="color: #2aa198;">'expenses'</span>
</pre>
</div>

<p>
К файлу с данными должен быть подключен отдельный файл с курсом валют. Это
простой текстовый файл, который выглядит так:
</p>
<div class="org-src-container">
<pre class="src src-ledger">P 2023-12-12 $ 90.9846 RUB
P 2023-12-12 EUR 98.0769 RUB
P 2023-12-14 $ 89.8926 RUB
P 2023-12-14 EUR 96.9500 RUB
P 2023-12-15 $ 89.6741 RUB
P 2023-12-15 EUR 97.7377 RUB
P 2023-12-16 $ 89.6966 RUB
P 2023-12-16 EUR 98.4186 RUB
</pre>
</div>

<p>
Естественно, заполнять его вручную не нужно — для этого есть bash, curl и
xsltproc. Курсы валют можно забирать с сайта ЦБ РФ, благо они предоставляют
пригодный к использованию XML<sup><a id="fnr.vbr_xml" class="footref" href="#fn.vbr_xml" role="doc-backlink">1</a></sup>. Например, для получения курса
доллара на дату 2022-12-12 нужно выполнить запрос:
<a href="https://cbr.ru/scripts/XML_dynamic.asp?date_req1=12/12/2023&amp;date_req2=12/12/2023&amp;VAL_NM_RQ=R01235">https://cbr.ru/scripts/XML_dynamic.asp?date_req1=12/12/2023&amp;date_req2=12/12/2023&amp;VAL_NM_RQ=R01235</a>. В
ответ вернётся вот такой XML:
</p>
<div class="org-src-container">
<pre class="src src-xml"><span style="color: #657b83; background-color: #fdf6e3;">&lt;</span><span style="color: #268bd2;">ValCurs</span> <span style="color: #268bd2;">ID</span>=<span style="color: #2aa198;">"R01235"</span> <span style="color: #268bd2;">DateRange1</span>=<span style="color: #2aa198;">"12.12.2023"</span> <span style="color: #268bd2;">DateRange2</span>=<span style="color: #2aa198;">"12.12.2023"</span> <span style="color: #268bd2;">name</span>=<span style="color: #2aa198;">"Foreign Currency Market Dynamic"</span><span style="color: #657b83; background-color: #fdf6e3;">&gt;</span>
    <span style="color: #657b83; background-color: #fdf6e3;">&lt;</span><span style="color: #268bd2;">Record</span> <span style="color: #268bd2;">Date</span>=<span style="color: #2aa198;">"12.12.2023"</span> <span style="color: #268bd2;">Id</span>=<span style="color: #2aa198;">"R01235"</span><span style="color: #657b83; background-color: #fdf6e3;">&gt;</span>
        <span style="color: #657b83; background-color: #fdf6e3;">&lt;</span><span style="color: #268bd2;">Nominal</span><span style="color: #657b83; background-color: #fdf6e3;">&gt;</span><span style="color: #657b83; background-color: #fdf6e3;">1</span><span style="color: #657b83; background-color: #fdf6e3;">&lt;</span><span style="color: #657b83; background-color: #fdf6e3;">/</span><span style="color: #268bd2;">Nominal</span><span style="color: #657b83; background-color: #fdf6e3;">&gt;</span>
        <span style="color: #657b83; background-color: #fdf6e3;">&lt;</span><span style="color: #268bd2;">Value</span><span style="color: #657b83; background-color: #fdf6e3;">&gt;</span><span style="color: #657b83; background-color: #fdf6e3;">90,9846</span><span style="color: #657b83; background-color: #fdf6e3;">&lt;</span><span style="color: #657b83; background-color: #fdf6e3;">/</span><span style="color: #268bd2;">Value</span><span style="color: #657b83; background-color: #fdf6e3;">&gt;</span>
        <span style="color: #657b83; background-color: #fdf6e3;">&lt;</span><span style="color: #268bd2;">VunitRate</span><span style="color: #657b83; background-color: #fdf6e3;">&gt;</span><span style="color: #657b83; background-color: #fdf6e3;">90,9846</span><span style="color: #657b83; background-color: #fdf6e3;">&lt;</span><span style="color: #657b83; background-color: #fdf6e3;">/</span><span style="color: #268bd2;">VunitRate</span><span style="color: #657b83; background-color: #fdf6e3;">&gt;</span>
    <span style="color: #657b83; background-color: #fdf6e3;">&lt;</span><span style="color: #657b83; background-color: #fdf6e3;">/</span><span style="color: #268bd2;">Record</span><span style="color: #657b83; background-color: #fdf6e3;">&gt;</span>
<span style="color: #657b83; background-color: #fdf6e3;">&lt;</span><span style="color: #657b83; background-color: #fdf6e3;">/</span><span style="color: #268bd2;">ValCurs</span><span style="color: #657b83; background-color: #fdf6e3;">&gt;</span>
</pre>
</div>

<p>
Вытащить из него данные с нужной нам ноды можно при помощи xsltproc и такого
XSLT:
</p>
<div class="org-src-container">
<pre class="src src-xml"><span style="color: #657b83; background-color: #fdf6e3;">&lt;</span><span style="color: #657b83; font-weight: bold;">xsl</span><span style="color: #657b83; background-color: #fdf6e3;">:</span><span style="color: #268bd2;">stylesheet</span> <span style="color: #657b83; font-weight: bold;">xmlns</span><span style="color: #657b83; background-color: #fdf6e3;">:</span><span style="color: #268bd2;">xsl</span>=<span style="color: #2aa198;">"http://www.w3.org/1999/XSL/Transform"</span> <span style="color: #268bd2;">version</span>=<span style="color: #2aa198;">"1.0"</span><span style="color: #657b83; background-color: #fdf6e3;">&gt;</span>
  <span style="color: #657b83; background-color: #fdf6e3;">&lt;</span><span style="color: #657b83; font-weight: bold;">xsl</span><span style="color: #657b83; background-color: #fdf6e3;">:</span><span style="color: #268bd2;">output</span> <span style="color: #268bd2;">method</span>=<span style="color: #2aa198;">"text"</span><span style="color: #657b83; background-color: #fdf6e3;">/</span><span style="color: #657b83; background-color: #fdf6e3;">&gt;</span>
  <span style="color: #657b83; background-color: #fdf6e3;">&lt;</span><span style="color: #657b83; font-weight: bold;">xsl</span><span style="color: #657b83; background-color: #fdf6e3;">:</span><span style="color: #268bd2;">template</span> <span style="color: #268bd2;">match</span>=<span style="color: #2aa198;">"ValCurs"</span><span style="color: #657b83; background-color: #fdf6e3;">&gt;</span>
    <span style="color: #657b83; background-color: #fdf6e3;">&lt;</span><span style="color: #657b83; font-weight: bold;">xsl</span><span style="color: #657b83; background-color: #fdf6e3;">:</span><span style="color: #268bd2;">for-each</span> <span style="color: #268bd2;">select</span>=<span style="color: #2aa198;">"Record"</span><span style="color: #657b83; background-color: #fdf6e3;">&gt;</span>
      <span style="color: #657b83; background-color: #fdf6e3;">&lt;</span><span style="color: #657b83; font-weight: bold;">xsl</span><span style="color: #657b83; background-color: #fdf6e3;">:</span><span style="color: #268bd2;">value-of</span> <span style="color: #268bd2;">select</span>=<span style="color: #2aa198;">"Value"</span><span style="color: #657b83; background-color: #fdf6e3;">/</span><span style="color: #657b83; background-color: #fdf6e3;">&gt;</span>
    <span style="color: #657b83; background-color: #fdf6e3;">&lt;</span><span style="color: #657b83; background-color: #fdf6e3;">/</span><span style="color: #657b83; font-weight: bold;">xsl</span><span style="color: #657b83; background-color: #fdf6e3;">:</span><span style="color: #268bd2;">for-each</span><span style="color: #657b83; background-color: #fdf6e3;">&gt;</span>
  <span style="color: #657b83; background-color: #fdf6e3;">&lt;</span><span style="color: #657b83; background-color: #fdf6e3;">/</span><span style="color: #657b83; font-weight: bold;">xsl</span><span style="color: #657b83; background-color: #fdf6e3;">:</span><span style="color: #268bd2;">template</span><span style="color: #657b83; background-color: #fdf6e3;">&gt;</span>
<span style="color: #657b83; background-color: #fdf6e3;">&lt;</span><span style="color: #657b83; background-color: #fdf6e3;">/</span><span style="color: #657b83; font-weight: bold;">xsl</span><span style="color: #657b83; background-color: #fdf6e3;">:</span><span style="color: #268bd2;">stylesheet</span><span style="color: #657b83; background-color: #fdf6e3;">&gt;</span>
</pre>
</div>

<p>
Всё это объединяется в bash-скрипте:
</p>
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #93a1a1;">#</span><span style="color: #93a1a1;">!/usr/bin/</span><span style="color: #859900; font-weight: bold;">env</span><span style="color: #93a1a1;"> bash</span>

<span style="color: #657b83; font-weight: bold;">declare</span> -A <span style="color: #268bd2;">CURRENCY_CODES</span>=([<span style="color: #2aa198;">"$"</span>]=<span style="color: #2aa198;">"R01235"</span> [<span style="color: #2aa198;">"EUR"</span>]=<span style="color: #2aa198;">"R01239"</span>)
<span style="color: #268bd2;">CBR_DATE</span>=$(date <span style="color: #2aa198;">'+%d/%m/%Y'</span>)
<span style="color: #268bd2;">CBR_XSLT</span>=$(mktemp /tmp/cbr.XXXXXX.xslt)

<span style="color: #268bd2;">JOURNAL</span>=<span style="color: #2aa198;">"$HOME/path/to/exchange_rates.journal"</span>
<span style="color: #268bd2;">JOURNAL_DATE</span>=$(date <span style="color: #2aa198;">'+%Y-%m-%d'</span>)

cat &lt;&lt; EOF &gt; <span style="color: #2aa198;">"$CBR_XSLT"</span>
<span style="color: #b58900; font-weight: bold;">&lt;xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0"&gt;</span>
<span style="color: #b58900; font-weight: bold;">  &lt;xsl:output method="text"/&gt;</span>
<span style="color: #b58900; font-weight: bold;">  &lt;xsl:template match="ValCurs"&gt;</span>
<span style="color: #b58900; font-weight: bold;">    &lt;xsl:for-each select="Record"&gt;</span>
<span style="color: #b58900; font-weight: bold;">      &lt;xsl:value-of select="Value"/&gt;</span>
<span style="color: #b58900; font-weight: bold;">    &lt;/xsl:for-each&gt;</span>
<span style="color: #b58900; font-weight: bold;">  &lt;/xsl:template&gt;</span>
<span style="color: #b58900; font-weight: bold;">&lt;/xsl:stylesheet&gt;</span>
<span style="color: #b58900; font-weight: bold;">EOF</span>

<span style="color: #859900; font-weight: bold;">for</span> curr<span style="color: #859900; font-weight: bold;"> in</span> <span style="color: #2aa198;">"${!CURRENCY_CODES[@]}"</span>; <span style="color: #859900; font-weight: bold;">do</span>
    <span style="color: #268bd2;">URL</span>=<span style="color: #2aa198;">"https://cbr.ru/scripts/XML_dynamic.asp?date_req1=$CBR_DATE&amp;date_req2=$CBR_DATE&amp;VAL_NM_RQ=${CURRENCY_CODES[$curr]}"</span>
    <span style="color: #268bd2;">EXCHANGE_RATE</span>=$(curl -s <span style="color: #2aa198;">"$URL"</span> | xsltproc <span style="color: #2aa198;">"$CBR_XSLT"</span> - | sed <span style="color: #2aa198;">'s/,/./g'</span>)
    <span style="color: #859900; font-weight: bold;">if</span> [ <span style="color: #b58900; font-weight: bold;">!</span> -n <span style="color: #2aa198;">"$EXCHANGE_RATE"</span> ]; <span style="color: #859900; font-weight: bold;">then</span>
        <span style="color: #859900; font-weight: bold;">continue</span>
    <span style="color: #859900; font-weight: bold;">fi</span>
    <span style="color: #657b83; font-weight: bold;">echo</span> <span style="color: #2aa198;">"P $JOURNAL_DATE $curr $EXCHANGE_RATE RUB"</span> &gt;&gt; <span style="color: #2aa198;">"$JOURNAL"</span>
<span style="color: #859900; font-weight: bold;">done</span>

rm -f <span style="color: #2aa198;">"$CBR_XSLT"</span>
</pre>
</div>

<p>
Который запускается по cron'у каждый день. В итоге у вас всегда свежие курсы
валют, обновляющиеся каждый день!
</p>
</div>
</div>
<div class="outline-3">
<h3>Статистика по расходам за каждый месяц</h3>
<div class="outline-text-3">

<div class="figure">
<p><img src="/assets/static/expenses.png" alt="expenses.png" />
</p>
</div>

<p>
Теперь самое интересное — расширение возможностей hledger.
</p>

<p>
Hledger умеет экспортировать свои отчёты в CSV, а SQLite умеет загонять этот
CSV в таблицы в in-memory базу данных. Что крайне упрощает дальнейшую
обработку всего этого дела, благо SQL предоставляет побольше возможностей, чем
hledger.
</p>

<p>
Достаточно быстро я разобрался, что расходы, разбитые по месяцам, можно
получить такой командой:
</p>
<div class="org-src-container">
<pre class="src src-bash">hledger -s --value=then,RUB reg -M -E -O csv <span style="color: #2aa198;">'expenses'</span>
</pre>
</div>

<p>
Путь к файлу не нужно указывать, если он уже указан в переменной окружения
<code>LEDGER_FILE</code>.
</p>

<p>
Но вывод этой команды (даже если убрать <code>-O csv</code>) не сильно пригоден для чтения
человеком:
</p>
<pre class="example">
"txnidx","date","code","description","account","amount","total"
...
"0","2023-11-01","","","expenses:leisure","432.00 RUB","1437564.28 RUB"
"0","2023-11-01","","","expenses:psychotherapy","998.00 RUB","1454562.28 RUB"
"0","2023-11-01","","","expenses:transport","57.00 RUB","1480019.28 RUB"
"0","2023-12-01","","","expenses:leisure","0","1481009.28 RUB"
"0","2023-12-01","","","expenses:psychotherapy","237.96 RUB","1503697.24 RUB"
"0","2023-12-01","","","expenses:transport","0","1503697.24 RUB"
...
</pre>

<p>
Да и для SQLite он тоже не пригоден — кавычки не нужны. А нужных мне для
дальнейших расчётов столбцов всего три — дата, статья расходов и сумма
израсходованных средств. Суффикс <code>RUB</code> тоже не нужен — <b>все</b> суммы и так уже в
рублях. К счастью, тут на помощь приходит магия AWK:
</p>
<div class="org-src-container">
<pre class="src src-bash">awk <span style="color: #2aa198;">'BEGIN {FS=","; OFS=","}</span>
<span style="color: #2aa198;">{</span>
<span style="color: #2aa198;">    gsub(/"/, "", $0);</span>
<span style="color: #2aa198;">    gsub(" RUB", "", $0);</span>
<span style="color: #2aa198;">    print $2, $5, $6;</span>
<span style="color: #2aa198;">}'</span>
</pre>
</div>

<p>
В итоге вывод hledger превращается в:
</p>
<pre class="example">
date,account,amount
...
2023-11-01,expenses:leisure,432.00
2023-11-01,expenses:psychotherapy,998.00
2023-11-01,expenses:transport,57.00
2023-12-01,expenses:leisure,0
2023-12-01,expenses:psychotherapy,237.96
2023-12-01,expenses:transport,0
...
</pre>

<p>
Этот CSV уже можно подавать на вход sqlite3, чтобы дальше обрабатывать
получившуюся таблицу <code>expenses</code> при помощи SQL:
</p>
<div class="org-src-container">
<pre class="src src-bash">sqlite3 -header -csv <span style="color: #2aa198;">':memory:'</span> <span style="color: #2aa198;">'.import --csv /dev/stdin expenses'</span> <span style="color: #2aa198;">"</span>
</pre>
</div>

<p>
Тут после двойной кавычки идёт SQL, который превращает сырые данные из таблицы
<code>expenses</code> в нужную мне таблицу:
</p>
<ol class="org-ol">
<li><p>
Сначала я сортирую таблицу <code>expenses</code> по дате и по статьям расходов, чтобы
записи в таблице <b>точно</b> шли в нужном порядке:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #859900; font-weight: bold;">WITH</span> ordered_expenses <span style="color: #859900; font-weight: bold;">AS</span> (
    <span style="color: #859900; font-weight: bold;">SELECT</span> * <span style="color: #859900; font-weight: bold;">FROM</span> expenses
    <span style="color: #859900; font-weight: bold;">ORDER</span> <span style="color: #859900; font-weight: bold;">BY</span> <span style="color: #b58900;">date</span>, account),
</pre>
</div>

<pre class="example">
+------------+------------------------+--------+
|    date    |        account         | amount |
+------------+------------------------+--------+
| 2023-11-01 | expenses:leisure       | 432.00 |
| 2023-11-01 | expenses:psychotherapy | 998.00 |
| 2023-11-01 | expenses:transport     | 57.00  |
| 2023-12-01 | expenses:leisure       | 0      |
| 2023-12-01 | expenses:psychotherapy | 237.96 |
| 2023-12-01 | expenses:transport     | 0      |
+------------+------------------------+--------+
</pre></li>
<li><p>
Потом использую оконную функцию, чтобы имена счетов шли по оси X, а даты
так и оставались на оси Y. Примерно вот так:
</p>
<pre class="example">
|------------+---------+-----------+-----|
|       date | leisure | transport | hcs |
|------------+---------+-----------+-----|
| 2023-11-01 |         |           |     |
| 2023-12-01 |         |           |     |
|------------+---------+-----------+-----|
</pre>

<p>
Следующий запрос делает таблицу, которая будет последовательно заполняться
данными о расходах:
</p>
<div class="org-src-container">
<pre class="src src-sql">expenses4gnuplot <span style="color: #859900; font-weight: bold;">AS</span> (
<span style="color: #859900; font-weight: bold;">SELECT</span> <span style="color: #b58900;">date</span>,                                           <span style="color: #93a1a1;">-- </span><span style="color: #93a1a1;">Reversed alphanumeric sorting here:</span>
    lag(amount, 0) OVER expenses_win <span style="color: #859900; font-weight: bold;">AS</span> transport,     <span style="color: #93a1a1;">-- </span><span style="color: #93a1a1;">expenses:transport</span>
    lag(amount, 1) OVER expenses_win <span style="color: #859900; font-weight: bold;">AS</span> rent,          <span style="color: #93a1a1;">-- </span><span style="color: #93a1a1;">expenses:rent</span>
    lag(amount, 2) OVER expenses_win <span style="color: #859900; font-weight: bold;">AS</span> psychotherapy, <span style="color: #93a1a1;">-- </span><span style="color: #93a1a1;">expenses:psychotherapy</span>
    lag(amount, 3) OVER expenses_win <span style="color: #859900; font-weight: bold;">AS</span> leisure,       <span style="color: #93a1a1;">-- </span><span style="color: #93a1a1;">expenses:leisure</span>
    lag(amount, 4) OVER expenses_win <span style="color: #859900; font-weight: bold;">AS</span> household,     <span style="color: #93a1a1;">-- </span><span style="color: #93a1a1;">expenses:household</span>
    lag(amount, 5) OVER expenses_win <span style="color: #859900; font-weight: bold;">AS</span> health,        <span style="color: #93a1a1;">-- </span><span style="color: #93a1a1;">expenses:health</span>
    lag(amount, 6) OVER expenses_win <span style="color: #859900; font-weight: bold;">AS</span> hcs,           <span style="color: #93a1a1;">-- </span><span style="color: #93a1a1;">expenses:hcs</span>
    lag(amount, 7) OVER expenses_win <span style="color: #859900; font-weight: bold;">AS</span> food,          <span style="color: #93a1a1;">-- </span><span style="color: #93a1a1;">expenses:food</span>
    lag(amount, 8) OVER expenses_win <span style="color: #859900; font-weight: bold;">AS</span> communication, <span style="color: #93a1a1;">-- </span><span style="color: #93a1a1;">expenses:communication</span>
    row_number() OVER expenses_win <span style="color: #859900; font-weight: bold;">AS</span> rownumber
<span style="color: #859900; font-weight: bold;">FROM</span> ordered_expenses
WINDOW expenses_win <span style="color: #859900; font-weight: bold;">AS</span>(PARTITION <span style="color: #859900; font-weight: bold;">BY</span> <span style="color: #b58900;">date</span>)
<span style="color: #859900; font-weight: bold;">ORDER</span> <span style="color: #859900; font-weight: bold;">BY</span> <span style="color: #b58900;">date</span>, account, rownumber),
</pre>
</div>

<p>
Результат получается примерно вот таким:
</p>
<pre class="example">
+------------+-----------+---------------+---------+-----------+
|    date    | transport | psychotherapy | leisure | rownumber |
+------------+-----------+---------------+---------+-----------+
| 2023-11-01 | 432.00    |               |         | 1         |
| 2023-11-01 | 998.00    | 432.00        |         | 2         |
| 2023-11-01 | 57.00     | 998.00        | 432.00  | 3         |
| 2023-12-01 | 0         |               |         | 1         |
| 2023-12-01 | 237.96    | 0             |         | 2         |
| 2023-12-01 | 0         | 237.96        | 0       | 3         |
+------------+-----------+---------------+---------+-----------+
</pre></li>
<li><p>
Очевидно, что мне нужны только те строки, где <code>rownumber = 3</code>. Чтобы их
выбрать — сохраняю даты и соответствующий максимальный <code>rownumber</code> в
отдельной таблице <code>last</code>. Понятно, что список статей расходов для каждого
месяца должен совпадать — иначе всё сломается. Именно для этого я явно
указываю расход в 0 рублей для каждой расходной статьи каждые две недели.
</p>

<p>
Запрос для получения таблицы <code>last</code>:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #859900; font-weight: bold;">last</span> <span style="color: #859900; font-weight: bold;">AS</span> (
<span style="color: #859900; font-weight: bold;">SELECT</span> <span style="color: #b58900;">date</span>,
    <span style="color: #657b83; font-weight: bold;">max</span>(rownumber) <span style="color: #859900; font-weight: bold;">AS</span> maxrownumber
<span style="color: #859900; font-weight: bold;">FROM</span> expenses4gnuplot <span style="color: #859900; font-weight: bold;">GROUP</span> <span style="color: #859900; font-weight: bold;">BY</span> <span style="color: #b58900;">date</span>)
</pre>
</div>

<pre class="example">
+------------+--------------+
|    date    | maxrownumber |
+------------+--------------+
| 2023-11-01 | 3            |
| 2023-12-01 | 3            |
+------------+--------------+
</pre></li>
<li><p>
Ну и наконец я могу объединить таблицы <code>expenses</code> и <code>last</code>. Если у sqlite3
поменять опцию <code>--csv</code> на <code>--table</code>, то получается вот такая красивая таблица:
</p>
<pre class="example">
+------------+---------+---------------+-----------+
|    Date    | Leisure | Psychotherapy | Transport |
+------------+---------+---------------+-----------+
| 2023-11-01 | 432.00  | 998.00        | 57.00     |
| 2023-12-01 | 0       | 237.96        | 0         |
+------------+---------+---------------+-----------+
</pre>

<p>
При помощи вот такого SQL запроса:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #859900; font-weight: bold;">SELECT</span> e4g.<span style="color: #b58900;">date</span> <span style="color: #859900; font-weight: bold;">AS</span> <span style="color: #b58900;">Date</span>,
    e4g.communication <span style="color: #859900; font-weight: bold;">AS</span> Communication,
    e4g.food <span style="color: #859900; font-weight: bold;">AS</span> Food,
    e4g.hcs <span style="color: #859900; font-weight: bold;">AS</span> HCS,
    e4g.health <span style="color: #859900; font-weight: bold;">AS</span> Health,
    e4g.household <span style="color: #859900; font-weight: bold;">AS</span> Household,
    e4g.leisure <span style="color: #859900; font-weight: bold;">AS</span> Leisure,
    e4g.psychotherapy <span style="color: #859900; font-weight: bold;">AS</span> Psychotherapy,
    e4g.rent <span style="color: #859900; font-weight: bold;">AS</span> Rent,
    e4g.transport <span style="color: #859900; font-weight: bold;">AS</span> Transport
<span style="color: #859900; font-weight: bold;">FROM</span> expenses4gnuplot <span style="color: #859900; font-weight: bold;">AS</span> e4g
<span style="color: #859900; font-weight: bold;">JOIN</span> <span style="color: #859900; font-weight: bold;">last</span> <span style="color: #859900; font-weight: bold;">ON</span> e4g.<span style="color: #b58900;">date</span> = <span style="color: #859900; font-weight: bold;">last</span>.<span style="color: #b58900;">date</span> <span style="color: #859900; font-weight: bold;">AND</span> e4g.rownumber = <span style="color: #859900; font-weight: bold;">last</span>.maxrownumber
<span style="color: #859900; font-weight: bold;">ORDER</span> <span style="color: #859900; font-weight: bold;">BY</span> e4g.<span style="color: #b58900;">date</span>;
</pre>
</div></li>
</ol>
</div>
</div>
<div class="outline-3">
<h3>Данные по накоплениям</h3>
<div class="outline-text-3">

<div class="figure">
<p><img src="/assets/static/savings.png" alt="savings.png" />
</p>
</div>

<p>
С накоплениями по месяцам всё точно так же, как и с расходами. Только данные
от hledger'а теперь получаем по счетам <code>savings</code>.
</p>
</div>
</div>
<div class="outline-3">
<h3>Планирование нового бюджета</h3>
<div class="outline-text-3">
<p>
Планирование бюджета происходит через bash-скрипт с dialog:
</p>


<div class="figure">
<p><img src="/assets/static/plan1.png" alt="plan1.png" />
</p>
<p style="text-align: center"><i>Выбор стартовой даты для нового бюджета</i></p>
</div>


<div class="figure">
<p><img src="/assets/static/plan2.png" alt="plan2.png" />
</p>
<p style="text-align: center"><i>Ввод данных по накоплениям</i></p>
</div>


<div class="figure">
<p><img src="/assets/static/plan3.png" alt="plan3.png" />
</p>
<p style="text-align: center"><i>Сумма пришедшей зарплаты, плюс остатки с предыдущей итерации</i></p>
</div>


<div class="figure">
<p><img src="/assets/static/plan4.png" alt="plan4.png" />
</p>
<p style="text-align: center"><i>Составление бюджета</i></p>
</div>


<div class="figure">
<p><img src="/assets/static/plan5.png" alt="plan5.png" />
</p>
<p style="text-align: center"><i>Проверка того, что мы не ушли в минус</i></p>
</div>

<p>
Тут всё реализовано относительно просто:
</p>
<ul class="org-ul">
<li>Получаю нужные данные от пользователя через формы dialog — даты, суммы
накоплений, план расходов для бюджета.</li>
<li><p>
Чтобы не вводить много данных, вытаскиваю из базы накопления для предыдущей
бюджетной записи и подставляю их в форму:
</p>
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #268bd2;">SAVINGS_DATA</span>=$(hledger -s --value=then,RUB reg -E -O csv <span style="color: #2aa198;">'savings'</span> |
    grep -v <span style="color: #2aa198;">'savings:foreign'</span> |
    awk <span style="color: #2aa198;">'BEGIN {FS=","; OFS=","}</span>
<span style="color: #2aa198;">    {</span>
<span style="color: #2aa198;">        gsub(/"/, "", $0);</span>
<span style="color: #2aa198;">        gsub(" RUB", "", $0);</span>
<span style="color: #2aa198;">        print $2, $5, $6;</span>
<span style="color: #2aa198;">    }'</span> |
    sqlite3 -csv <span style="color: #2aa198;">':memory:'</span> <span style="color: #2aa198;">'.import --csv /dev/stdin savings'</span> <span style="color: #2aa198;">"</span>
<span style="color: #2aa198;">    WITH ordered_savings AS (</span>
<span style="color: #2aa198;">        SELECT date, account, amount FROM savings</span>
<span style="color: #2aa198;">        WHERE date = (SELECT max(date) FROM savings)</span>
<span style="color: #2aa198;">        ORDER BY date, account),</span>
<span style="color: #2aa198;">    savings4gnuplot AS (</span>
<span style="color: #2aa198;">        SELECT date,                                        -- Reversed alphanumeric sorting here:</span>
<span style="color: #2aa198;">            lag(amount, 0) OVER savings_win AS touching,    -- savings:touching</span>
<span style="color: #2aa198;">            lag(amount, 1) OVER savings_win AS investments, -- savings:investments</span>
<span style="color: #2aa198;">            lag(amount, 2) OVER savings_win AS emergency,   -- savings:emergency</span>
<span style="color: #2aa198;">            row_number() OVER savings_win AS rownumber</span>
<span style="color: #2aa198;">        FROM ordered_savings</span>
<span style="color: #2aa198;">        WINDOW savings_win AS(PARTITION BY date)</span>
<span style="color: #2aa198;">        ORDER BY date, account, rownumber),</span>
<span style="color: #2aa198;">    last AS (</span>
<span style="color: #2aa198;">        SELECT date,</span>
<span style="color: #2aa198;">            max(rownumber) AS maxrownumber</span>
<span style="color: #2aa198;">        FROM savings4gnuplot GROUP BY date)</span>
<span style="color: #2aa198;">    SELECT s4g.touching||' '||s4g.emergency||' '||s4g.investments</span>
<span style="color: #2aa198;">    FROM savings4gnuplot AS s4g</span>
<span style="color: #2aa198;">    JOIN last ON s4g.date = last.date AND s4g.rownumber = last.maxrownumber</span>
<span style="color: #2aa198;">    ORDER BY s4g.date;"</span> |
    sed <span style="color: #2aa198;">'s/\"//g'</span>)

<span style="color: #268bd2;">OLDIFS</span>=<span style="color: #2aa198;">"$IFS"</span>
<span style="color: #657b83; font-weight: bold;">read</span> -ra SAVINGS_ARRAY &lt;&lt;&lt; <span style="color: #2aa198;">"$SAVINGS_DATA"</span>
<span style="color: #268bd2;">IFS</span>=<span style="color: #2aa198;">"$OLDIFS"</span>

<span style="color: #268bd2;">SAVINGS</span>=(${<span style="color: #268bd2;">SAVINGS_ARRAY</span>[0]} ${<span style="color: #268bd2;">SAVINGS_ARRAY</span>[1]} ${<span style="color: #268bd2;">SAVINGS_ARRAY</span>[2]} 0 0)
<span style="color: #268bd2;">BUDGET_SAVINGS</span>=($($<span style="color: #268bd2;">DIALOG</span> --form <span style="color: #2aa198;">"Savings information:"</span> 11 43 5 <span style="color: #b58900; font-weight: bold;">\</span>
    <span style="color: #2aa198;">"Touching fund (RUB)"</span> 1 1 <span style="color: #2aa198;">"${SAVINGS[0]}"</span> 1 22 15 10 <span style="color: #b58900; font-weight: bold;">\</span>
    <span style="color: #2aa198;">"Emergency fund (RUB)"</span> 2 1 <span style="color: #2aa198;">"${SAVINGS[1]}"</span> 2 22 15 10 <span style="color: #b58900; font-weight: bold;">\</span>
    <span style="color: #2aa198;">"Investments (RUB)"</span> 3 1 <span style="color: #2aa198;">"${SAVINGS[2]}"</span> 3 22 15 10 <span style="color: #b58900; font-weight: bold;">\</span>
    <span style="color: #2aa198;">"USD"</span> 4 1 <span style="color: #2aa198;">"${SAVINGS[3]}"</span> 4 22 15 10 <span style="color: #b58900; font-weight: bold;">\</span>
    <span style="color: #2aa198;">"EUR"</span> 5 1 <span style="color: #2aa198;">"${SAVINGS[4]}"</span> 5 22 15 10 <span style="color: #b58900; font-weight: bold;">\</span>
    2&gt;&amp;1 1&gt;&amp;3))
</pre>
</div></li>
<li>Результаты просто перенаправляю в виде, пригодном для ledger'а, в файл
<code>$LEDGER_FILE</code>.</li>
</ul>
<hr />
</div>
</div>
</div>
<div id="footnotes">

<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.vbr_xml" class="footnum" href="#fnr.vbr_xml" role="doc-backlink">1</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
С техническим описанием можно ознакомиться тут:
<a href="https://cbr.ru/development/SXML/">https://cbr.ru/development/SXML/</a>
</p></div></div>


</div>
</div>
