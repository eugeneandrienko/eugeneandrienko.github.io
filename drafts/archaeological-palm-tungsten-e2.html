<!doctype html>
<html lang="ru">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>  Археологическое программирование под Palm Tungsten E2 | Dragon's notes
</title>
  <link rel="canonical" href="https://eugene-andrienko.com/drafts/archaeological-palm-tungsten-e2.html">

<link rel="apple-touch-icon" sizes="180x180" href="/theme/icons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/theme/icons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/theme/icons/favicon-16x16.png">
<link rel="manifest" href="/theme/icons/site.webmanifest">
<link rel="mask-icon" href="/theme/icons/safari-pinned-tab.svg" color="#5bbad5">
<link rel="shortcut icon" href="/theme/icons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="Драконовы заметки">
<meta name="application-name" content="Драконовы заметки">
<meta name="msapplication-TileColor" content="#00aba9">
<meta name="msapplication-config" content="/theme/icons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">    <link rel="manifest" href="https://eugene-andrienko.com/manifest.json">

  <link rel="stylesheet" href="https://eugene-andrienko.com/theme/css/lumen.min.css">

  <link rel="alternate" type="application/atom+xml" title="Full Atom Feed"
        href="https://eugene-andrienko.com/feeds/all.atom.xml">
  <link rel="alternate" type="application/atom+xml" title="Categories Atom Feed"
        href="https://eugene-andrienko.com/feeds/it.atom.xml">  
  <meta name="description" content="TODO">


</head>

<body>
  <header class="header">
    <div class="container">
<div class="row">
    <div class="col-sm-4">
      <a href="https://eugene-andrienko.com/">
        <img class="img-fluid rounded" src=https://eugene-andrienko.com/theme/images/siteimage.png alt="Dragon's notes">
      </a>
    </div>
  <div class="col-sm-8">
    <h1 class="title"><a href="https://eugene-andrienko.com/" style="color: black">Dragon's notes</a></h1>
      <ul class="list-inline">
          <li class="list-inline-item"><a class="fab fa-github" href="https://github.com/eugeneandrienko" target="_blank" style="color: black"></a></li>
          <li class="list-inline-item"><a class="fab fa-linkedin" href="https://www.linkedin.com/in/eugeneandrienko" target="_blank" style="color: black"></a></li>
          <li class="list-inline-item"><a class="fab fa-strava" href="https://www.strava.com/athletes/8248131" target="_blank" style="color: black"></a></li>
      </ul>
  </div>
</div>    </div>
  </header>

  <div class="main">
    <div class="container">
      <h1>  Археологическое программирование под Palm Tungsten&nbsp;E2
</h1>
  <article class="article">
    <div class="content">
      <div class="contents topic" id="topic-1">
<p class="topic-title">Содержание</p>
<ul class="simple">
<li><a class="reference internal" href="#palmos" id="toc-entry-1">Где сейчас можно купить девайс с PalmOS на борту?</a></li>
<li><a class="reference internal" href="#palm-os" id="toc-entry-2">Цифровое наследие Palm <span class="caps">OS</span></a><ul>
<li><a class="reference internal" href="#palm" id="toc-entry-3">ПО для Palm’ы</a></li>
<li><a class="reference internal" href="#sd" id="toc-entry-4">Решение проблемы с <span class="caps">SD</span>-картами</a></li>
</ul>
</li>
<li><a class="reference internal" href="#section-1" id="toc-entry-5">Ретропрограммирование</a><ul>
<li><a class="reference internal" href="#section-2" id="toc-entry-6">Низкоуровневое программирование</a></li>
<li><a class="reference internal" href="#java-palm-os-5" id="toc-entry-7">Java и Palm <span class="caps">OS</span> 5</a></li>
</ul>
</li>
</ul>
</div>
<blockquote class="epigraph blockquote">
Фам Нювен несколько лет провел, обучаясь программировать и
исследовать. Программирование восходило к началу времен. Как та навозная куча
за замком отца. Когда ее промыло ручьем на десять метров в глубь, обнаружились
искореженные корпуса машин — летающих машин, как говорили крестьяне, еще от
тех великих дней колонизации Канберры. Но та навозная куча была чистой и
свежей по сравнению с тем, что лежало в локальной сети «Репризы». — Вернор
Виндж: «Глубина в небе»</blockquote>
<p><span class="bukvica">В</span></p>
<p>сё, как оно обычно и бывает, началось случайно. Однажды мне попалась на глаза
<a class="reference external" href="https://github.com/readme/featured/vintage-computing">статья про vintage computing</a>. Оказывается, люди до сих пор успешно используют
Palm’ы и всякие Apple Newton’ы по их прямому назначению — как персональные
цифровые ассистенты (<span class="caps">PDA</span>). Тут я вспомнил свой первый опыт с вроде бы Palm
IIIc. У нас в университете (ИТМО) проводились тесты на этих КПК — мы решали
всякие задачи со стилусом в руках в каком-то самописном приложении.
Пользоваться теми Palm’ами было приятно (а вот решать задачи по классической
механике — не очень).</p>
<p>И тут мне пришла в голову мысль: «А почему бы не купить себе Palm и не начать
использовать его как те чуваки из статьи?» Наверное, можно взять какой-нибудь
старый девайс и начать там вести свои списки дел, заметки и контролировать
расходы на покушац, благо Palm вроде как специально заточен для подобных
вещей. На <span class="caps">PC</span> я использую для всего вышеперечисленного <a class="reference external" href="https://orgmode.org/">Org Mode</a>, но постоянно
таскать с собой ноутбук неудобно, а единственное приложение на телефоне,
которое понимает таблицы с формулами из Org Mode — это Emacs. А работать с
Emacs на сенсорной клавиатуре — прямой путь к умножению страданий и скорби в
этом мире.</p>
<p>Я думал, что скорее всего можно будет найти или написать программу, которая
будет работать с org-файлами и на Palm’ах. Спойлер: ничего подобного найти не
удалось, видимо потому что Org Mode был придуман тогда, когда эра этих КПК уже
подходила к концу. Пришлось закапываться в археологическое программирование,
чтобы научить Palm понимать мои хитровыделанные таблицы с формулами, часть из
которых написана на Emacs Lisp’е.</p>
<div class="section" id="palmos">
<h2>Где сейчас можно купить девайс с PalmOS на борту?</h2>
<p><span class="bukvica">К</span></p>
<p>счастью, сами Palm’ы ещё не являются бесценными музейными реликвиями и их до
сих пор можно найти на разных сайтах с объявлениями. К Интернету эти
устройства <a class="reference external" href="https://palmdb.net/help/internet-connect#setup-bt">не так уж и просто подключить</a>, встроенный браузер больше не
работает с современными сайтами, новых приложений для них больше не пишут, а
<a class="reference external" href="https://archive.org/details/palm3_tiktok">TikTok</a> для PalmOS (v3.5) выглядит вот так:</p>
<img alt="tiktok on palm" class="img-fluid align-center" src="../images/IT/2023/tiktok.png" style="width: 50%;"/>
<p>Поэтому стоят они не так уж и много и за 3-4 тысячи рублей можно отыскать
новый КПК, на котором даже муха не сидела.</p>
<p>Мне повезло найти абсолютно новый Palm Tungsten E2 в запаянной коробке из
закромов какой-то московской фирмы:</p>
<div class="figure align-center">
<img alt="box contents" class="img-fluid" src="../images/IT/2023/P1283929.jpg"/>
<p class="caption">Содержимое коробки</p>
</div>
<p>От времени пострадал только клей на подсказках с росчерками Graffiti 2, да
аккумулятор — он полностью сел за 16 лет лежания в коробке. К счастью, менять
его не потребовалось — 15 минут на зарядке и устройство ожило:</p>
<img alt="palm os startup" class="img-fluid align-center" src="../images/IT/2023/P1283931.jpg" style="width: 50%;"/>
<p>Использовать, да и просто держать этот Palm в руке невообразимо приятно —
строгий и небольшой металлический корпус, не вызывающий ассоциаций с куском
мыла, по своему прекрасен. У металлического же стилуса чувствуется небольшой
вес, когда берёшь его в руку — подозреваю, что он цельнолитой, а не полый. Так
и хочется постоянно доставать его, чтобы просто подержать в
руках. Единственный минус — пластмассовая защелка для крепления стилуса в
корпусе — мне кажется, что через несколько лет она сотрётся и стилус начнёт выпадать.</p>
<p>Если сами Palm’ы пока ещё можно отыскать, то с расходниками или запасными
частями для них всё гораздо сложнее (тут надо учитывать, что поскольку я имею
российское гражданство — мне недоступен ни Amazon, ни eBay, ни
<a class="reference external" href="https://www.palmdr.com/">PalmDR</a>). Потратив пару недель я не смог найти крэдл и запасные стилусы. Не
говорю уже о красивом металлическом чехле.</p>
</div>
<div class="section" id="palm-os">
<h2>Цифровое наследие Palm <span class="caps">OS</span></h2>
<p><span class="bukvica">П</span></p>
<p>оигравшись с купленным устройством я нашёл много интересных вещей, которые
увы не дожили до наших дней в масс-маркете:</p>
<ul>
<li><p class="first">Аскетичная операционная система из коробки — без лишнего мусора от вендора,
вроде неудаляемых без переподвыверта приложений для «очистки» памяти,
социальных сетей, «левых» магазинов с ПО и так далее.</p>
</li>
<li><p class="first"><strong>Долгая</strong> работать от аккумулятора — с первой же зарядки мой Palm прожил N дней!</p>
</li>
<li><p class="first">Рукописный ввод текста стилусом. Мои страдания при использовании виртуальной
сенсорной клавиатуры на современных Android’ах невозможно описать. Не
помогает ни свайп, ни автодополнение с исправлением ошибок — семь потов
сойдёт пока напечатаешь хотя бы пару абзацев без опечаток, со всеми нужными
знаками препинания! А всё потому, что мышечная память при печати на
сенсорном экране не используется. Если во времена Siemens M55 я мог вслепую
нащупать тактильную пупырку на кнопке <tt class="docutils literal">5 jkl</tt> и спокойно напечатать хоть
«Войну и мир», то сейчас проще подключить внешнюю Bluetooth-клавиатуру к
смартфону, во избежание невосполнимой траты нервных клеток и последующего
разбивания телефона о стену (поэтому он у меня ударопрочный).</p>
</li>
<li><p class="first">Стандартные приложения заботятся о минимизации пользовательского ввода. Eсли
в главном окне начать писать что-то стилусом — приложение подхватит ввод и
сделает с ним что-нибудь разумное. Список дел — сохранит текст в новой
заметке. Календарь — использует написанные цифры как время для нового
события. И так далее.</p>
</li>
<li><p class="first"><a class="reference external" href="https://enlight.ru/pilot/soft_os_shortcuts.html">Есть хоткеи</a>. Работают они по тому же принципу, что и на <span class="caps">PC</span> — только вместо
комбинации клавиш у нас специальный росчерк и буква:</p>
<img alt="palm hotkeys" class="align-left img-fluid" src="../images/IT/2023/palm-menu-hotkeys.png" style="width: 40%;"/>
</li>
<li><p class="first"><strong>Четыре</strong> аппаратных кнопки для запуска программ. При этом запущенная программа
обрабатывает повторное нажатие на кнопку. Так, в календаре у нас меняется
вид календаря. В списке дел — происходит переключение между общим списком,
делами за последние 7 дней и пропущенными делами.</p>
<p>В эмуляторе Palm <span class="caps">OS</span> 3.5 это выглядит примерно вот так:</p>
<img alt="switch cycle" class="align-left img-fluid" src="../images/IT/2023/palm-button-cycle.webp" style="width: 30%;"/>
</li>
</ul>
<p>Минусы у Palm’а тоже были — в основном связанные с древностью устройства — нет
ни поддержки современных протоколов передачи данных, ни поддержки современных
форматов файлов (например, docx или xlsx). Но show stopper’ами для меня стали
следующие вещи.</p>
<p>Tungsten E2 <a class="reference external" href="https://www.palmdr.com/maximum-memory-card-size-for-palm-os">«из коробки» не работает</a> с <span class="caps">SD</span>-картами больше 1 Gb. У меня была
карточка на 2 Gb родом из 2008 года — и она не распознавалась устройством. К
счастью, для этой проблемы я нашёл простое решение.</p>
<p>Вторая проблема была связана со временем. В PalmOS 5.4.7 Garnet поддерживаются
даты лишь до 31 декабря 2031 года — в календаре нет ничего после этой даты.</p>
<div class="figure align-left">
<img alt="palm 2031 problem" class="img-fluid" src="../images/IT/2023/palm-2031-problem.png" style="width: 55%;"/>
<p class="caption">В эмуляторе с PalmOS 3.5 — та же проблема.</p>
</div>
<p>Из объяснения <a class="reference external" href="https://www.reddit.com/r/Palm/comments/9ffeth/comment/e5wxemc/?utm_source=share&amp;utm_medium=web2x&amp;context=3">на Reddit’е</a>: время в Palm <span class="caps">OS</span> сохраняется как 32-bit unsigned
integer и отсчёт ведётся примерно с начала <span class="caps">XX</span> века (возможно, из-за
необходимости сохранять даты дней рождений для прабабушек/прадедушек?). И в
2031 году счётчик переполняется — поэтому 2032 года для PalmOS просто не
существует. Несмотря на обилие всяких хаков для системы — решения этой
проблемы с датой <em>почему-то</em> до сих пор нет.</p>
<div class="section" id="palm">
<h3>ПО для Palm’ы</h3>
<p><span class="bukvica">П</span></p>
<p>рограммы, игры и хаки, написанные для Palm <span class="caps">OS</span> не канули в Лету — благодаря
усилиям энтузиастов, которые стремятся сохранить это цифровое наследие для
истории. Если бы не они, то эта статья уже закончилась бы. А сами Palm’ы были
бы не более чем бесполезными кусками пластика и текстолита, которые можно
разве что поставить на полку в музее. Либо использовать в качестве донора
деталей для очередного хобби-проекта на Arduino/RaspberryPi.</p>
<p>Тем не менее, я рекомендую не надеяться на энтузиастов и сохранять всё
найденное на жёсткий диск, потому что совершенно неясно как долго архивы с
программным обеспечением будут в онлайне.</p>
<p>Вот небольшой список архивов с ПО, живых на момент написания статьи:</p>
<ul class="simple">
<li><a class="reference external" href="https://palmdb.net/">https://palmdb.net/</a> — целое сообщество, ставящее целью сохранить всё, что
относится к Palm, для истории. Тут есть как сами программы, так и образы
дисков, среды разработки, архивы сайтов и так далее.</li>
<li><a class="reference external" href="http://freeware.palmclub.nl/">http://freeware.palmclub.nl/</a></li>
<li><a class="reference external" href="https://archive.org/details/softwarelibrary_palm">https://archive.org/details/softwarelibrary_palm</a>. В этом архиве есть
необычная и удобная вещь — на странице каждой программы имеется встроенный
эмулятор, который позволяет поработать с программой в браузере прежде чем её
устанавливать. Некоторые скриншоты из этой статьи сделаны именно в этом эмуляторе.</li>
<li><a class="reference external" href="http://hpc.ru/soft/index.phtml?pl167=on">http://hpc.ru/soft/index.phtml?pl167=on</a></li>
<li><a class="reference external" href="http://palmarchive.com/files/">http://palmarchive.com/files/</a></li>
<li><a class="reference external" href="http://www.pda-archives.com/pilot.shtml">http://www.pda-archives.com/pilot.shtml</a></li>
</ul>
<p>Установка программ в Palm проста и сложна одновременно. Саму программу
достаточно скачать с одного из архивов выше — она представляет собой просто
<a class="reference external" href="https://en.wikipedia.org/wiki/PRC_(Palm_OS)"><span class="caps">PRC</span> файл</a>. А вот затем надо каким-то образом доставить этот файл в память Palm’а.</p>
<p>В поисках решения я дошёл до статьи <a class="reference external" href="https://www.ibiblio.org/pub/Linux/docs/HOWTO/other-formats/html_single/PalmOS-HOWTO.html">«Palm <span class="caps">OS</span> Desktop <span class="caps">HOWTO</span>»</a> аж за 2002 год.
Это может показаться удивительным для нашего постоянно меняющегося мира <span class="caps">IT</span>, но
решение оттуда работает и 20 лет спустя! Для установки программы всего то был
нужен набор утилит под названием pilot-link. Ссылка на сайт разработчика
pilot-link естественно уже мертва, но к счастью, добрый человек выложил
<a class="reference external" href="https://github.com/jichu4n/pilot-link">исходные коды</a> на GitHub. Там же, другой хороший человек оставил <a class="reference external" href="https://dev.gentoo.org/~mgorny/dist/pilot-link-0.12.5-gentoo-patchset.tar.bz2">ссылку на
патчи</a> от ментейнеров Gentoo.</p>
<p>Как пользователь этого дистрибутива — я просто установил следующий пакет и всё заработало:</p>
<pre class="literal-block">
*  app-pda/pilot-link
      Latest version available: 0.12.5-r4
      Latest version installed: 0.12.5-r4
      Size of files: 1,551 KiB
      Homepage:      https://github.com/jichu4n/pilot-link
      Description:   Suite of tools for moving data between a Palm device and a desktop
      License:       || ( GPL-2 LGPL-2 )
</pre>
<p>Пользователям других дистрибутивов видимо придётся скачивать исходные коды и
собирать их вручную. Несмотря на то, что последний раз в том репозитории
что-то меняли 7 лет назад — всё до сих пор спокойно собирается современным gcc.</p>
<p>А теперь можно переходить к установке скачанного <span class="caps">PRC</span>-файла в КПК. Не
волнуйтесь — это проще чем установить <span class="caps">APK</span>-файл на Android через <tt class="docutils literal">adb</tt>. Нужно
подключить Palm к компьютеру кабелем и нажать на кнопку синхронизации. После
этого достаточно выполнить команду:</p>
<pre class="literal-block">
% pilot-xfer -p /dev/ttyUSB1 -i ./your-program.prc
</pre>
<p>И всё — ваш Palm сначала издаст музыкальные звуки, похожие на озвучку работы
компьютеров в 80-е, и программа будет установлена.</p>
<p>Небольшое пояснение: после нажатия на кнопку синхронизации запускается
программа HotSync на Palm’е и на стороне Linux’а создаются два символьных
устройства: <tt class="docutils literal">/dev/ttyUSB0</tt> и <tt class="docutils literal">/dev/ttyUSB1</tt>. Для установки ПО используется второе устройство.</p>
</div>
<div class="section" id="sd">
<h3>Решение проблемы с <span class="caps">SD</span>-картами</h3>
<p><span class="bukvica">Р</span></p>
<p>ешать проблемы, связанные с Palm <span class="caps">OS</span>, сложно. Многих сайтов давно уже нет в
онлайне, многие статьи полны ссылок, ведущих в никуда. Очень спасает
сообщество <a class="reference external" href="https://www.reddit.com/r/Palm/">r/Palm</a> на Реддите.</p>
<p>Помогло оно и в этот раз. Поиск в сообществе вывел меня на комментарий, где
человек описывал ту же проблему с <span class="caps">SD</span>-картами, что и у меня. Он привёл ссылку
<a class="reference external" href="https://palm2000.com/projects/usingMoreThan2GBInASonyClieWithPalmOS5x.php">на статью</a> о «новом» драйвере для Palm <span class="caps">OS</span> 5.x за авторством небезызвестного в
узких кругах Palm’оводов Dmitry Grinberg, в котором была реализована поддержка
файловой системы <span class="caps">FAT32</span>. Ссылка на сайт PalmPowerups с драйвером естественно
была мертва, как и сам сайт. Вообще, когда дело касается Palm надо привыкать к
мёртвым ссылкам.</p>
<p>К счастью, в статье упоминалось, что файл с драйвером называется
<tt class="docutils literal"><span class="pre"><span class="caps">FAT32</span>-loader-final.prc</span></tt>. Непродолжительный поиск привёл <a class="reference external" href="https://palmdb.net/app/powersdhc">вот на эту страницу</a>,
где был и нужный мне файл, и стороннее приложение, добавляющее поддержку карт
стандарта <span class="caps">SDHC</span> и <span class="caps">SDXC</span>.</p>
<p>Драйвер был немедленно установлен и теперь вставленная карта распознавалась
устройством. Но при каждой вставке карты на экране показывалась непонятная
ошибка: <em>«The startup application from this card cannot be run»</em>. К счастью, всё
то же сообщество r/Palm помогло мне и с этой проблемой. Поиск привёл меня к
следующему комментарию от u/user5518:</p>
<pre class="literal-block">
Yes, your Clié can this by default. Copy your .prc and .pdb files on the
Memory Stick in the folder "*Palm/Launcher*" directory. (Should be created
automatically when you format the stick in the Clié.) Then you can open the
applications from the MS on your NR70/v.
</pre>
<p>Тут описывается как «научить» Sony Clie запускать <span class="caps">PRC</span>-файлы с карты.</p>
<p>Я предположил, что операционная система ожидает на <span class="caps">SD</span>-карте определённую
структуру каталогов. А при виде пустой карточки Palm «теряется» и выдаёт
ошибку. В сети не нашлось никакой информации о том, какие каталоги должны быть
на <span class="caps">SD</span>-карте, как и самих образов карточек, чтобы можно было посмотреть как там
сделано. Ради теста создал на карточке пустые каталоги, которые упоминал u/user5518:</p>
<pre class="literal-block">
./
└── Palm/
    └── Launcher/

2 directories, 0 files
</pre>
<p>И ошибка после вставки <span class="caps">SD</span>-карты в Palm Tungsten E2 — пропала!</p>
<hr class="docutils"/>
<p><span class="bukvica">П</span></p>
<p>одытоживая — пользоваться этим динозавром по прежнему можно. В сети есть как
множество архивов с ПО, поддерживаемых энтузиастами. Так и множество
энтузиастов, которые могут помочь с проблемой. Не стоит сбрасывать со счетов и
старые сайты со старым ПО — хоть там половина ссылок и не работает, крупицы
информации из статей всё ещё могут помочь или хотя бы натолкнуть на нужное решение.</p>
</div>
</div>
<div class="section" id="section-1">
<h2>Ретропрограммирование</h2>
<div class="section" id="section-2">
<h3>Низкоуровневое программирование</h3>
</div>
<div class="section" id="java-palm-os-5">
<h3>Java и Palm <span class="caps">OS</span> 5</h3>
<p>Хоть это и не видно из написанного выше, но на самом деле я обычный
Java-программист, кофехлёб, 100kk SingletonFactoryGeneratorDecorator в
наносекунду. Поэтому, программа для работы с моими org-файлами будет писаться
на Java.</p>
</div>
</div>

    </div>
    <br/>
    <header class="text-right">
      <small>
        <ul class="list-inline">
          <li class="list-inline-item">
            <i class="fas fa-folder-open"></i>
            <a href="https://eugene-andrienko.com/category/it.html">IT</a>
          </li>
          <li class="list-inline-item text-muted" title="2023-01-29T12:35:00+03:00">
            29 January 2023 (Sun)
          </li>
        </ul>
      </small>
    </header>
  </article>
    </div>
  </div>

  <footer class="footer">
    <div class="container">
<div class="row">
  <ul class="col-sm-4 list-inline">
    <li class="list-inline-item"><a href="https://eugene-andrienko.com/archives.html">Archive</a></li>
    <li class="list-inline-item"><a href="https://eugene-andrienko.com/categories.html">Categories</a></li>
      <li class="list-inline-item"><a href="https://eugene-andrienko.com/tags.html">Tags</a></li>
  </ul>
  <p class="col-sm-8 text-sm-right text-muted">
      <small>
        Built by <a href="https://github.com/getpelican/pelican" target="_blank">Pelican</a>
        / <a href="https://github.com/nairobilug/pelican-alchemy" target="_blank">&#x2728;</a>.

        Fonts: <a href="https://github.com/typiconman/fonts-cu" target="_blank">Monomakh Unicode</a>,
        <a href="https://github.com/akryukov/oldstand" target="_blank">Old Standard</a>,
        <a href="https://github.com/slavonic/FiraSlav" target="_blank">Fira Slav</a>
      </small>
  </p>
</div>    </div>
  </footer>

  <link rel="stylesheet" href="https://eugene-andrienko.com/theme/css/fontawesome.min.css">
  <link rel="stylesheet" href="https://eugene-andrienko.com/theme/css/pygments/emacs.min.css">
  <link rel="stylesheet" href="https://eugene-andrienko.com/theme/css/theme.css">
</body>

</html>